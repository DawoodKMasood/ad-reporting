# Multiple Google Ads Accounts Support\n\n## Overview\n\nThis implementation provides comprehensive support for managing multiple Google Ads accounts within a single user account. When users connect their Google Ads account, the system automatically detects and connects all accessible accounts, including manager accounts and individual advertiser accounts.\n\n## Key Features\n\n### 1. Automatic Multi-Account Detection\n- When connecting Google Ads, the system calls `listAccessibleCustomers` API to get all accounts\n- Automatically creates separate `ConnectedAccount` records for each accessible account\n- Stores account metadata including name, timezone, test account status, and manager account status\n\n### 2. Account Formatting\n- Customer IDs are formatted from `1234567890` to `123-456-7890` for better readability\n- Display names can be customized by users\n- Account types are clearly indicated (Test Account, Manager Account)\n\n### 3. Account Management UI Components\n\n#### Account Switcher (`components/account-switcher.edge`)\n- Dropdown component for switching between accounts\n- Shows formatted account IDs and account types\n- Persists current account selection in localStorage\n- Triggers account change events for other components\n\n#### Multi-Account Dashboard (`components/multi-account-dashboard.edge`)\n- Displays metrics for the currently selected account\n- Real-time metric loading and refreshing\n- Account-specific performance data\n\n#### Bulk Account Manager (`components/bulk-account-manager.edge`)\n- Grid view of all connected accounts\n- Bulk selection and synchronization\n- Individual account quick actions\n- Account status and metrics overview\n\n### 4. Enhanced Database Schema\n\nNew fields added to `connected_accounts` table:\n- `display_name`: User-friendly custom name\n- `is_manager_account`: Boolean flag for manager accounts\n- `parent_account_id`: Reference to parent manager account\n- `accessible_customers`: JSON array of all accessible customer IDs\n- `account_name`: Official account name from Google Ads\n- `account_timezone`: Account timezone\n- `is_test_account`: Boolean flag for test accounts\n\n### 5. API Enhancements\n\n#### Google Ads OAuth Service\n- `getAccessibleCustomers()`: Retrieves all accessible accounts\n- `getCustomerInfo()`: Fetches account metadata\n- `storeTokensForAllCustomers()`: Creates records for all accounts\n\n#### Account Management API\n- `GET /integrations/accounts`: List all connected accounts\n- `POST /integrations/accounts/:id/switch`: Switch current account\n- `GET /integrations/accounts/:id/metrics`: Get account-specific metrics\n- `PATCH /integrations/:id/name`: Update account display name\n\n### 6. Fixed Google Ads API Queries\n\nAll Google Ads API calls have been updated to use proper GAQL (Google Ads Query Language) syntax instead of the simplified API methods to fix the error:\n\"Must specify at least one field in (\"attributes\",\"metrics\",\"segments\")\"\n\n## Usage Examples\n\n### Connecting Multiple Accounts\n```javascript\n// When user clicks \"Connect Google Ads\"\n// System automatically:\n// 1. Authenticates with Google\n// 2. Calls listAccessibleCustomers API\n// 3. Creates ConnectedAccount records for each account\n// 4. Shows success modal with all connected accounts\n```\n\n### Account Switching\n```javascript\n// User selects account from dropdown\naccountSwitcher.switchAccount(accountId)\n// Triggers accountChanged event\n// Updates localStorage\n// Refreshes dashboard metrics\n```\n\n### Bulk Operations\n```javascript\n// User selects multiple accounts and clicks \"Sync Selected\"\nbulkAccountManager.syncSelected()\n// Syncs each account sequentially\n// Shows progress and results\n```\n\n## Integration Points\n\n### Dashboard Integration\n- Account switcher in dashboard header\n- Multi-account dashboard component\n- Account-specific metrics display\n\n### Integrations Page\n- Enhanced connected accounts display\n- Bulk management interface (when multiple accounts exist)\n- Account overview statistics\n\n### Campaign Data\n- All campaign data tied to specific account IDs\n- Account context maintained throughout the application\n- Proper data isolation between accounts\n\n## Error Handling\n\n### API Query Fixes\n- Updated all Google Ads API calls to use proper GAQL syntax\n- Added required field selections for attributes, metrics, and segments\n- Proper error handling for API failures\n\n### Token Management\n- Shared OAuth tokens across all accounts from same Google login\n- Proper token encryption and decryption\n- Refresh token handling for all accounts\n\n## Security Considerations\n\n- All tokens encrypted before database storage\n- Account access validated by user ownership\n- API calls scoped to specific accounts\n- No cross-account data leakage\n\n## Performance Optimizations\n\n- Caching of account lists and metrics\n- Lazy loading of account-specific data\n- Bulk operations for efficiency\n- Optimized database queries\n\n## Future Enhancements\n\n- Account grouping and hierarchical display\n- Advanced bulk operations (pause/resume campaigns)\n- Account-level budget management\n- Cross-account reporting and comparisons\n- Account permission management\n